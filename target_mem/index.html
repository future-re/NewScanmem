<!DOCTYPE html>
<html class="writer-html5" lang="zh" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Future Re" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>目标内存 - NewScanmem Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u76ee\u6807\u5185\u5b58";
        var mkdocs_page_input_path = "target_mem.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> NewScanmem Documentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="搜索文档" aria-label="搜索文档" title="在此输入需要搜索的内容" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="导航栏">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">首页</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../API_REFERENCE/">API 参考</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../endianness/">大端小端</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../main/">主程序</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../maps/">内存映射</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../process_checker/">进程检查器</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../sets/">集合</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../show_message/">显示消息</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">目标内存</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_2">概述</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">模块结构</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_4">依赖项</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_5">核心功能</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1">1. 内存匹配标志</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-oldvalueandmatchinfo">2. OldValueAndMatchInfo 结构</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3-matchesandoldvaluesswath">3. MatchesAndOldValuesSwath 类</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#_6">方法</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#4-matchesandoldvaluesarray">4. MatchesAndOldValuesArray 类</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#matchesandoldvaluesarray">MatchesAndOldValuesArray方法</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_7">使用示例</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_8">基本使用</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_9">搜索操作</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_10">字符串表示</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_11">内存管理</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_12">内存布局</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_13">内存对齐</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_14">内存安全</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_15">性能优化</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_16">搜索优化</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_17">内存使用</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_18">算法复杂度</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_19">错误处理</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_20">常见错误</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_21">错误处理策略</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_22">扩展性</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_23">自定义匹配类型</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_24">自定义数据结构</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_25">插件支持</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../value/">值</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../NamingConvention/">命名规则</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="移动导航栏">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">NewScanmem Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="文档"></a></li>
      <li class="breadcrumb-item active">目标内存</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/future-re/NewScanmem/edit/master/docs/target_mem.md" class="icon icon-github"> 在GitHub上编辑</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1">目标内存模块文档</h1>
<h2 id="_2">概述</h2>
<p><code>targetmem</code> 模块为 NewScanmem 项目提供内存匹配和分析结构。它包括用于管理内存匹配、存储旧值以及执行内存区域操作的类，支持高效的搜索和操作。</p>
<h2 id="_3">模块结构</h2>
<pre><code class="language-cpp">export module targetmem;
</code></pre>
<h2 id="_4">依赖项</h2>
<ul>
<li><code>&lt;algorithm&gt;</code> - 标准算法</li>
<li><code>&lt;cassert&gt;</code> - 断言宏</li>
<li><code>&lt;cctype&gt;</code> - 字符分类</li>
<li><code>&lt;cstddef&gt;</code> - 大小类型定义</li>
<li><code>&lt;cstdint&gt;</code> - 固定宽度整数类型</li>
<li><code>&lt;cstdio&gt;</code> - C 标准 I/O</li>
<li><code>&lt;cstdlib&gt;</code> - C 标准库</li>
<li><code>&lt;cstring&gt;</code> - C 字符串操作</li>
<li><code>&lt;optional&gt;</code> - 可选类型支持</li>
<li><code>&lt;sstream&gt;</code> - 字符串流操作</li>
<li><code>&lt;string&gt;</code> - 字符串操作</li>
<li><code>&lt;vector&gt;</code> - 动态数组容器</li>
<li><code>value</code> 模块 - 值类型定义</li>
<li><code>show_message</code> 模块 - 消息打印系统</li>
</ul>
<h2 id="_5">核心功能</h2>
<h3 id="1">1. 内存匹配标志</h3>
<p>使用来自 <code>value</code> 模块的 <code>MatchFlags</code> 来指示内存匹配的类型和状态。</p>
<h3 id="2-oldvalueandmatchinfo">2. OldValueAndMatchInfo 结构</h3>
<pre><code class="language-cpp">struct OldValueAndMatchInfo {
    uint8_t old_value;      // 原始字节值
    MatchFlags match_info;  // 匹配类型和状态标志
};
</code></pre>
<h3 id="3-matchesandoldvaluesswath">3. MatchesAndOldValuesSwath 类</h3>
<p>表示具有匹配信息的连续内存区域。</p>
<pre><code class="language-cpp">class MatchesAndOldValuesSwath {
public:
    void* firstByteInChild = nullptr;                    // 起始地址
    std::vector&lt;OldValueAndMatchInfo&gt; data;              // 匹配数据

    // 构造函数
    MatchesAndOldValuesSwath() = default;

    // 元素管理
    void addElement(void* addr, uint8_t byte, MatchFlags matchFlags);

    // 字符串表示工具
    std::string toPrintableString(size_t idx, size_t len) const;
    std::string toByteArrayText(size_t idx, size_t len) const;
};
</code></pre>
<h4 id="_6">方法</h4>
<h5 id="addelementvoid-addr-uint8_t-byte-matchflags-matchflags">addElement(void* addr, uint8_t byte, MatchFlags matchFlags)</h5>
<p>向 swath 添加新的内存匹配。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>addr</code>: 匹配的内存地址</li>
<li><code>byte</code>: 此地址的字节值</li>
<li><code>matchFlags</code>: 匹配类型和标志</li>
</ul>
<h5 id="toprintablestringsize_t-idx-size_t-len">toPrintableString(size_t idx, size_t len)</h5>
<p>将内存字节转换为可打印的 ASCII 字符串。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>idx</code>: 数据向量中的起始索引</li>
<li><code>len</code>: 要转换的字节数</li>
</ul>
<p><strong>返回：</strong> 可打印字符串，不可打印字符显示为 '.'</p>
<h5 id="tobytearraytextsize_t-idx-size_t-len">toByteArrayText(size_t idx, size_t len)</h5>
<p>将内存字节转换为十六进制文本表示。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>idx</code>: 数据向量中的起始索引</li>
<li><code>len</code>: 要转换的字节数</li>
</ul>
<p><strong>返回：</strong> 空格分隔的十六进制值</p>
<h3 id="4-matchesandoldvaluesarray">4. MatchesAndOldValuesArray 类</h3>
<p>管理多个 swath 并提供搜索操作。</p>
<pre><code class="language-cpp">class MatchesAndOldValuesArray {
public:
    std::vector&lt;MatchesAndOldValuesSwath&gt; swaths;        // 内存区域集合

    // 构造函数
    MatchesAndOldValuesArray() = default;

    // 搜索操作
    std::optional&lt;size_t&gt; findSwathIndex(void* addr) const;
    std::optional&lt;size_t&gt; findElementIndex(void* addr) const;

    // 数据访问
    const OldValueAndMatchInfo* getElement(void* addr) const;
    OldValueAndMatchInfo* getElement(void* addr);

    // 内存管理
    void clear();
    size_t size() const;
};
</code></pre>
<h4 id="matchesandoldvaluesarray">MatchesAndOldValuesArray方法</h4>
<h5 id="findswathindexvoid-addr-const">findSwathIndex(void* addr) const</h5>
<p>查找包含指定地址的 swath 索引。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>addr</code>: 要查找的内存地址</li>
</ul>
<p><strong>返回：</strong> 包含该地址的 swath 索引，如果未找到则返回 std::nullopt</p>
<h5 id="findelementindexvoid-addr-const">findElementIndex(void* addr) const</h5>
<p>查找指定地址在 swath 中的元素索引。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>addr</code>: 要查找的内存地址</li>
</ul>
<p><strong>返回：</strong> 元素在 swath 中的索引，如果未找到则返回 std::nullopt</p>
<h5 id="getelementvoid-addr">getElement(void* addr)</h5>
<p>获取指定地址的元素数据。</p>
<p><strong>参数：</strong></p>
<ul>
<li><code>addr</code>: 内存地址</li>
</ul>
<p><strong>返回：</strong> 指向 OldValueAndMatchInfo 的指针，如果未找到则返回 nullptr</p>
<h2 id="_7">使用示例</h2>
<h3 id="_8">基本使用</h3>
<pre><code class="language-cpp">import targetmem;

// 创建内存匹配数组
MatchesAndOldValuesArray matches;

// 添加内存匹配
void* addr1 = (void*)0x1000;
void* addr2 = (void*)0x1001;

MatchesAndOldValuesSwath swath;
swath.addElement(addr1, 0x42, MatchFlags::EXACT_MATCH);
swath.addElement(addr2, 0x7F, MatchFlags::GREATER_THAN);

matches.swaths.push_back(swath);
</code></pre>
<h3 id="_9">搜索操作</h3>
<pre><code class="language-cpp">// 查找包含地址的 swath
auto swathIndex = matches.findSwathIndex(addr1);
if (swathIndex) {
    std::cout &lt;&lt; &quot;找到 swath 索引: &quot; &lt;&lt; *swathIndex &lt;&lt; std::endl;
}

// 查找元素索引
auto elementIndex = matches.findElementIndex(addr1);
if (elementIndex) {
    std::cout &lt;&lt; &quot;找到元素索引: &quot; &lt;&lt; *elementIndex &lt;&lt; std::endl;
}

// 获取元素数据
const auto* element = matches.getElement(addr1);
if (element) {
    std::cout &lt;&lt; &quot;旧值: 0x&quot; &lt;&lt; std::hex &lt;&lt; (int)element-&gt;old_value &lt;&lt; std::endl;
}
</code></pre>
<h3 id="_10">字符串表示</h3>
<pre><code class="language-cpp">// 转换为可打印字符串
std::string printable = swath.toPrintableString(0, 10);
std::cout &lt;&lt; &quot;可打印字符串: &quot; &lt;&lt; printable &lt;&lt; std::endl;

// 转换为字节数组文本
std::string byteArray = swath.toByteArrayText(0, 10);
std::cout &lt;&lt; &quot;字节数组: &quot; &lt;&lt; byteArray &lt;&lt; std::endl;
</code></pre>
<h2 id="_11">内存管理</h2>
<h3 id="_12">内存布局</h3>
<p>每个 <code>MatchesAndOldValuesSwath</code> 表示一个连续的内存区域：</p>
<pre><code class="language-text">+----------------+----------------+----------------+
| 地址 0x1000    | 地址 0x1001    | 地址 0x1002    |
| 旧值: 0x42     | 旧值: 0x7F     | 旧值: 0xAA     |
| 标志: EXACT    | 标志: GREATER  | 标志: LESS     |
+----------------+----------------+----------------+
</code></pre>
<h3 id="_13">内存对齐</h3>
<ul>
<li>地址按字节对齐</li>
<li>数据结构紧凑存储</li>
<li>支持跨平台内存布局</li>
</ul>
<h3 id="_14">内存安全</h3>
<ul>
<li>边界检查防止越界访问</li>
<li>空指针检查</li>
<li>异常安全保证</li>
</ul>
<h2 id="_15">性能优化</h2>
<h3 id="_16">搜索优化</h3>
<ol>
<li><strong>二分搜索</strong>: 在有序 swath 中使用二分搜索</li>
<li><strong>地址范围检查</strong>: 快速过滤不相关的 swath</li>
<li><strong>缓存友好</strong>: 连续内存访问模式</li>
</ol>
<h3 id="_17">内存使用</h3>
<ol>
<li><strong>紧凑存储</strong>: 最小化内存占用</li>
<li><strong>动态增长</strong>: 按需分配内存</li>
<li><strong>内存池</strong>: 减少分配开销</li>
</ol>
<h3 id="_18">算法复杂度</h3>
<ul>
<li><strong>查找 swath</strong>: O(log n) 其中 n 是 swath 数量</li>
<li><strong>查找元素</strong>: O(log m) 其中 m 是 swath 中的元素数量</li>
<li><strong>添加元素</strong>: O(1) 平均情况</li>
</ul>
<h2 id="_19">错误处理</h2>
<h3 id="_20">常见错误</h3>
<ol>
<li><strong>无效地址</strong>: 空指针或无效内存地址</li>
<li><strong>越界访问</strong>: 访问超出范围的索引</li>
<li><strong>内存不足</strong>: 分配失败</li>
</ol>
<h3 id="_21">错误处理策略</h3>
<ul>
<li>使用 std::optional 表示查找失败</li>
<li>返回 nullptr 表示无效访问</li>
<li>抛出异常处理严重错误</li>
</ul>
<h2 id="_22">扩展性</h2>
<h3 id="_23">自定义匹配类型</h3>
<pre><code class="language-cpp">enum class CustomMatchFlags : uint8_t {
    CUSTOM_MATCH_1,
    CUSTOM_MATCH_2,
    // ... 其他类型
};
</code></pre>
<h3 id="_24">自定义数据结构</h3>
<pre><code class="language-cpp">struct CustomMatchInfo {
    uint8_t old_value;
    CustomMatchFlags flags;
    std::string additional_info;
};
</code></pre>
<h3 id="_25">插件支持</h3>
<pre><code class="language-cpp">class MatchPlugin {
public:
    virtual bool processMatch(void* addr, uint8_t value) = 0;
    virtual std::string getDescription() const = 0;
};
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="页脚导航">
        <a href="../show_message/" class="btn btn-neutral float-left" title="显示消息"><span class="icon icon-circle-arrow-left"></span> 上一章</a>
        <a href="../value/" class="btn btn-neutral float-right" title="值">下一章 <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  用<a href="https://www.mkdocs.org/">MkDocs</a>构建，使用<a href="https://readthedocs.org">Read the Docs</a>提供的<a href="https://github.com/readthedocs/sphinx_rtd_theme">主题</a>。
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="版本">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/future-re/NewScanmem" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../show_message/" style="color: #fcfcfc">&laquo; 上一章</a></span>
    
    
      <span><a href="../value/" style="color: #fcfcfc">下一章 &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
