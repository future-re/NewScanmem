# NewScanmem TODO

本文件梳理当前项目的关键问题与改进任务，按优先级与可交付验收标准组织，便于跟踪推进。

## 当前主要问题
- 使用人数少：缺少便捷接口与示例，学习曲线较高。
- 单元测试覆盖率不足：虽然已有 GoogleTest/CTest，但未量化覆盖率且关键路径未充分测试。
- 缺少便捷接口：未提供稳定的 C 接口与 Python 包，难以集成到其他语言/项目。
- 没有 GUI：仅有控制台抽象，缺少跨平台图形界面，影响易用性与可视化操作。
- 跨平台支持不足：未建立平台抽象层与多平台 CI，构建/运行受限于当前环境。

## 优先级与路线
1. 覆盖率与关键补测（提升稳定性，支撑后续重构与接口）
2. 设计并导出稳定 C API（形成公共库接口）
3. Python 绑定与示例（扩大用户群与易用性）
4. GUI 原型与应用（提升交互与可视化）
5. 跨平台构建与 CI（扩大适用范围）
6. 文档与示例完善（降低上手成本）

## 任务清单（带验收标准）

- [ ] 评估当前测试覆盖率（优先级：高）
  - 产出覆盖率基线报告（HTML/文本），列出薄弱模块与函数级清单。
  - 在仓库根生成 `coverage/` 目录存放报告与摘要。
  - 验收：本地构建可生成报告，`README.md` 增加生成步骤。

- [ ] 引入覆盖率工具链（优先级：高）
  - 在顶层 CMake 添加 `ENABLE_COVERAGE` 开关；GCC 用 `--coverage` + lcov，Clang 用 `llvm-cov`。
  - 新增 `coverage` 目标与 CI 步骤上传工件。
  - 验收：Linux CI 成功产出并上传覆盖率报告。

- [ ] 补充关键单元测试（优先级：高）
  - 为扫描器、值比较、并发、解析与过滤增加测试（`test/*`）。
  - 提升总体覆盖率到 ≥ 60%。
  - 验收：CTest 通过，覆盖率阈值达标。

- [ ] 设计稳定 C API（优先级：高）
  - 在 `include/newscanmem.h` 定义最小可用函数集：
    - `ns_open`, `ns_attach`, `ns_scan`, `ns_read`, `ns_write`, `ns_close`
    - 错误码与不透明句柄类型，避免 C++ 细节泄露到 ABI。
  - 设计文档：接口说明、线程安全策略、错误处理与版本化策略。
  - 验收：头文件完整、文档说明齐全。

- [ ] 实现并导出 C API（优先级：高）
  - 新增桥接实现 `.cpp`（非模块 TU），`extern "C"` 调用 C++20 模块。
  - 生成共享库 `libnewscanmem`，并提供 C 示例与 CTest。
  - 验收：示例可编译运行，导出符号可用（`nm`/`dumpbin` 验证）。

- [ ] Python 绑定方案选型（优先级：中）
  - 对比 `pybind11` 与 `ctypes/cffi`；选择 `pybind11` 为主、`ctypes` 为备。
  - 记录选型理由（类型安全、性能、维护成本），提交到 `mkdocs`。
  - 验收：形成简短设计说明并可在文档站点查看。

- [ ] 实现 Python 包（优先级：中）
  - 建立 `python/` 目录，使用 `pyproject.toml` + `scikit-build-core`/CMake 构建。
  - 实现模块 `newscanmem` 封装高层 API；编写 `pytest` 最小用例与示例。
  - 验收：本地 `pip install -e .` 成功，测试通过，示例可运行。

- [ ] GUI 原型设计（优先级：中）
  - 选框架（Qt 或 Dear ImGui + GLFW），绘制界面草图与交互流程：进程选择、扫描、结果表格、读写。
  - 产出任务分解与技术风险清单（权限、刷新频率、性能）。
  - 验收：设计稿与任务分解文档提交到仓库（`mkdocs` 或 `docs/`）。

- [ ] 实现 GUI 应用（优先级：中）
  - 在 `src/ui/` 添加 GUI 可执行目标，调用核心库。
  - 实现基础功能与打包脚本（Linux AppImage/Windows MSIX/macOS dmg 可后续考虑）。
  - 验收：原型可运行，完成基础操作（attach/扫描/读写/结果展示）。

- [ ] 跨平台构建支持（优先级：中）
  - 新增 `src/platform/{linux,windows,mac}` 分层；条件编译与统一 `platform.h` 接口。
  - 适配 MSVC/Clang 的编译选项与模块支持策略（必要时降级头文件接口）。
  - 验收：三平台本地/CI均能编译通过核心库与必要示例。

- [ ] CI/CD 多平台流水线（优先级：中）
  - GitHub Actions 矩阵：Ubuntu、Windows、macOS；构建、测试、覆盖率上传；缓存依赖（Boost/ICU/pybind11）。
  - 验收：三平台工作流稳定通过，工件（报告/二进制）可下载。

- [ ] 文档与示例完善（优先级：中）
  - 扩充 `mkdocs`：快速开始、C API、Python 包、GUI、跨平台安装。
  - 添加代码示例与截图，提升可发现性与易用性。
  - 验收：站点可本地构建，内容完整，首页提供清晰的上手路径。

## 备注与决策点
- C API 与 C++20 模块的桥接：使用常规 `.cpp` TU 暴露 `extern "C"`，内部 `import` 模块以确保 ABI 稳定与跨平台兼容性。
- Python 绑定：优先 `pybind11` 获取类型安全与性能；短期内也可通过 C API 用 `ctypes/cffi` 提供快速可用性。
- GUI 框架选型：Qt（成熟组件、跨平台） vs Dear ImGui（轻量、工具型 UI）；待确认偏好后实施。
