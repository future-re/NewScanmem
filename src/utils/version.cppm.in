module;

#include <array>

export module utils.version;

export namespace version {
constexpr int MAJOR_V = @PROJECT_VERSION_MAJOR@;
constexpr int MINOR_V = @PROJECT_VERSION_MINOR@;
constexpr int PATCH_V = @PROJECT_VERSION_PATCH@;

inline auto string() -> const char* {
    static std::array<char, 32> buf;
    int majorVal = MAJOR_V;
    int minorVal = MINOR_V;
    int patchVal = PATCH_V;

    auto writeInt = [](char* out, int value) {
        std::array<char, 12> tmp{};
        int len = 0;
        if (value == 0) {
            tmp[len++] = '0';
        }
        while (value > 0) {
            tmp[len++] = char('0' + (value % 10));
            value /= 10;
        }
        for (int i = 0; i < len; ++i) {
            out[i] = tmp[len - 1 - i];
        }
        return len;
    };

    int pos = 0;
    pos += writeInt(buf.data() + pos, majorVal);
    buf.data()[pos++] = '.';
    pos += writeInt(buf.data() + pos, minorVal);
    buf.data()[pos++] = '.';
    pos += writeInt(buf.data() + pos, patchVal);
    buf.data()[pos] = '\0';
    return buf.data();
}
}  // namespace version
